<!DOCTYPE html><html lang="zh-CN"><head><title>使用Artalk代替不蒜子统计PV</title><noscript>开启Javascript是必要的</noscript><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="ai: 这篇文章介绍了如何通过Artalk的OpenAPI使用ARTALK统计API，并提供了NUXT实现和原生JS实现的示例。对于NUXT实现，需要在组件完成挂载后请求，并传入origin；而对于原生JS实现，可以通过promise.all和fetch来实现。"><meta aria-keyshortcuts="Rootlex, blog, 技术, 博客"><link href="https://cdn1.tianli0.top/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet"><link href="/css/var.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><link href="/css/content.css" rel="stylesheet"><script src="/js/lib/pace.min.js"></script><link href="/css/hightlight/theme.css" rel="stylesheet"><script>var GLOBALCONFIG={root:"/",lazyload:{enable:!0,error:"https://cdn.skypro.cartafi.cn/2023/05/02/topimg.webp"},codelimit:300,lightbox:!0}</script><script id="site-config">var PAGECONFIG={is_home:!1,is_post:!0,is_page:!1,page:!1,comments:!0}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Rootlex Blog" type="application/atom+xml"></head><body><main class="layouts_warp"><div class="layouts_content"><div class="sidebar_main w-1-3" id="sidebar"><div class="site_name"><img src="/img/site.png" alt="网页标题" class="nolazyload"></div><ul class="menu" id="menu"><li class="menu_list"><a href="/" class="menu_item"><i class="ri-home-6-line"></i> <span class="menu_item_span">主页</span></a></li><li class="menu_list"><a href="/posts/" class="menu_item"><i class="ri-article-line"></i> <span class="menu_item_span">文章</span></a></li><li class="menu_list"><a href="/bgm/" class="menu_item"><i class="ri-movie-2-line"></i> <span class="menu_item_span">追番</span></a></li><li class="menu_list"><a href="/link/" class="menu_item"><i class="ri-links-line"></i> <span class="menu_item_span">朋友们</span></a></li><li class="menu_list"><a href="/me/" class="menu_item"><i class="ri-heart-line"></i> <span class="menu_item_span">关于我</span></a></li></ul><hr><div class="tab_warp"><input type="radio" name="side-tab" class="tab-radio-tj" id="card-selector-tj" checked> <input type="radio" name="side-tab" class="tab-radio-toc" id="card-selector-toc"><div class="tab_selector"><label for="card-selector-tj" class="tab-handler-tj">统计</label> <label for="card-selector-toc" class="tab-handler-toc">目录</label></div><div class="tab_content"><div class="tab_content-tj"><div class="statistics_item"><span class="statistics_span">文章</span> <span class="statistics_num">9 篇</span></div><div class="statistics_item"><span class="statistics_span">分类</span> <span class="statistics_num">3</span></div><div class="statistics_item"><span class="statistics_span">字数</span> <span class="statistics_num">7.8k</span></div><div class="statistics_item"><span class="statistics_span">运行</span> <span class="statistics_num">445 天</span></div></div><div class="tab_content-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Artalk%E7%BB%9F%E8%AE%A1-API-%E8%AF%B4%E6%98%8E"><span class="toc-text">Artalk统计 API 说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8API"><span class="toc-text">开始使用API</span></a></li></ol></div></div></div><div class="connect"><a target="_blank" rel="noopener" href="https://space.bilibili.com/494271806" style="color:#00b1ff" aria-label="bilibili"><i class="ri-bilibili-fill"></i></a><a target="_blank" rel="noopener" href="https://github.com/rootlexblog" style="color:#000" aria-label="github"><i class="ri-github-fill"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=3416536539" style="color:#ff3030" aria-label="网易云"><i class="ri-netease-cloud-music-fill"></i></a><a href="mailto:a@nalex.top" style="color:#ffc952" aria-label="邮箱"><i class="ri-mail-send-line"></i></a></div><div class="sidebar_footer"><div class="link"><a href="/privacy">隐私协议</a> <a href="/cc">版权声明</a></div><div class="link"><i class="ri-copyright-line"></i> <span>2023</span> <a href="/">Rootlex</a></div></div></div><div class="layouts_page_content w-2-3"><div class="nav hide" id="nav"><div class="nav_item"><a href="/" aria-label="主页" class="home"><i class="ri-home-6-line"></i></a><a class="rand_page" aria-label="随机页面" onclick="toRandomPost()"><i class="ri-shuffle-line"></i></a><div class="mobile_nav_item"><a class="menu_item" href="/" aria-label="主页"><i class="ri-home-6-line"></i></a><a class="menu_item" href="/posts/" aria-label="文章"><i class="ri-article-line"></i></a><a class="menu_item" href="/bgm/" aria-label="追番"><i class="ri-movie-2-line"></i></a><a class="menu_item" href="/link/" aria-label="朋友们"><i class="ri-links-line"></i></a><a class="menu_item" href="/me/" aria-label="关于我"><i class="ri-heart-line"></i></a></div></div><div class="nav_item"><a href="/atom.xml" aria-label="rss" target="_blank"><i class="ri-rss-fill"></i></a><a target="_blank" rel="noopener" href="https://www.travellings.cn/go.html" aria-label="开往"><i class="ri-subway-fill"></i></a></div></div><div class="content_top"><div class="top_img"><img src="https://cdn.skypro.cartafi.cn/2023/05/02/topimg.webp" alt="顶部头图" class="top_img_bg nolazyload"><div class="me"><span>Rootlex</span> <img src="https://cdn.skypro.cartafi.cn/2023/05/02/avatar.webp" alt="头像" class="avatar nolazyload"></div></div><div class="top_bar"><div class="cate_list" id="cate"><a class="cate_item" href="/">主页</a><div class="cate_list_item"><a class="cate_item" href="/categories/教程/">教程</a> <a class="cate_item" href="/categories/笔记/">笔记</a> <a class="cate_item" href="/categories/折腾/">折腾</a></div></div><div class="bar_dec"><span>寒蝉黎明之时，便是重生之日</span></div></div></div><div class="index_content"><div class="index_content_list_item"><div class="post_info">使用Artalk代替不蒜子统计PV</div><div class="content_g"><html><head></head><body><h2 id="Artalk统计-API-说明"><a href="#Artalk统计-API-说明" class="headerlink" title="Artalk统计 API 说明"></a>Artalk统计 API 说明</h2><p>此API可以在Artalk官方的<a target="_blank" rel="noopener" href="https://artalk.js.org/http-api.html#tag/Site">Openapi</a>中找到</p><pre class="language-http pre_code" data-language="http"><code class="language-http">POST /stat</code><div class="code-expand-btn"><i class="ri-arrow-drop-down-line"></i></div></pre><h2 id="开始使用API"><a href="#开始使用API" class="headerlink" title="开始使用API"></a>开始使用API</h2><h3 id="Nuxt实现"><a href="#Nuxt实现" class="headerlink" title="Nuxt实现"></a>Nuxt实现</h3><pre class="language-javascript pre_code" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_warp"</span><span class="token operator">&gt;</span>
      <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_item"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_span"</span><span class="token operator">&gt;</span>
          访问
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_num"</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> pv<span class="token punctuation">.</span>success <span class="token operator">?</span> pv<span class="token punctuation">.</span>data <span class="token operator">:</span> <span class="token string">'无法获取'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_item"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_span"</span><span class="token operator">&gt;</span>
          评论
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"static_num"</span><span class="token operator">&gt;</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> comments<span class="token punctuation">.</span>success <span class="token operator">?</span> comments<span class="token punctuation">.</span>data <span class="token operator">:</span> <span class="token string">'无法获取'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">...</span><span class="token operator">...</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script setup lang<span class="token operator">=</span><span class="token string">"ts"</span><span class="token operator">&gt;</span>
  <span class="token comment">/*
    侧栏统计组件
   */</span>

  <span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"#imports"</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> pv <span class="token operator">=</span> <span class="token function">useLazyAsyncData</span><span class="token punctuation">(</span><span class="token string">'pv'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/stat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'origin'</span><span class="token operator">:</span> <span class="token string">'你的源站'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token string">'site_pv'</span><span class="token punctuation">,</span>
      <span class="token string-property property">'site_name'</span><span class="token operator">:</span> <span class="token string">'Rootlex 的博客'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无法获取PV'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data
  <span class="token keyword">const</span> comments <span class="token operator">=</span> <span class="token function">useLazyAsyncData</span><span class="token punctuation">(</span><span class="token string">'comments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/stat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'origin'</span><span class="token operator">:</span> <span class="token string">'你的源站'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'type'</span><span class="token operator">:</span> <span class="token string">'site_comment'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'site_name'</span><span class="token operator">:</span> <span class="token string">'你站点的名字'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无法获取总comments数'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>data

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/pv'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">'page_key'</span><span class="token operator">:</span> <span class="token string">'你的源站'</span><span class="token punctuation">,</span>
        <span class="token string-property property">'site_name'</span><span class="token operator">:</span> <span class="token string">'Rootlex 的博客'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'无法提交PV'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></code><div class="code-expand-btn"><i class="ri-arrow-drop-down-line"></i></div></pre><p>在使用 <code>useLazyAsyncData</code> 需要传入 <code>origin</code>，因为服务端并不知道你的 <code>origin</code> 所以不会自动传入。如果我们不传入Artalk会阻止我们访问API。而在组件完成挂载后（<code>onMounted</code>）请求则不用传入。</p><p><strong>这里我在组件挂载后请求了 <code>/api/pv</code> 这个接口，用来增加和统计首页的PV</strong></p><h3 id="原生JS实现"><a href="#原生JS实现" class="headerlink" title="原生JS实现"></a>原生JS实现</h3><p>原生JS可以通过 <code>promise.all</code> 和 <code>fetch</code> 实现，<strong>此方法尚未经过博主测试，请谨慎使用</strong>，但JS写法应该是差不多的</p><pre class="language-javascript pre_code" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> siteName <span class="token operator">=</span> <span class="token string">'站点名称'</span>
<span class="token function">onload</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>pv<span class="token punctuation">,</span> comments<span class="token punctuation">,</span> postpv<span class="token punctuation">]</span> <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/stat'</span> <span class="token operator">+</span> <span class="token string">'?type=site_pv'</span> <span class="token operator">+</span> <span class="token string">'?site_name='</span> <span class="token operator">+</span> siteName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'无法获取PV'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/stat'</span> <span class="token operator">+</span> <span class="token string">'?type=site_comment'</span> <span class="token operator">+</span> <span class="token string">'?site_name='</span> <span class="token operator">+</span> siteName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'无法获取总comments数'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://你的Artalk域名/api/pv'</span> <span class="token operator">+</span> <span class="token string">'?page_key='</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>location<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'提交PV失败'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pv<span class="token punctuation">,</span>comments<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><div class="code-expand-btn"><i class="ri-arrow-drop-down-line"></i></div></pre></body></html></div><div class="comments_wrap"><div class="comments_top"><i class="ri-message-3-line"></i><div class="comment_title">评论</div></div><div id="comments"></div></div></div></div></div></div></main><div><script src="https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js"></script><script>function Comments(){twikoo.init({envId:"https://rootlex.zeabur.app",el:"#comments",lang:"zh-CN"})}</script><script src="/js/lib/pjax.min.js"></script><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.min.js"></script><script src="/js/lib/view-image.min.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-y/aplayer/1.10.1/APlayer.min.js"></script><link href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/aplayer/1.10.1/APlayer.min.css" rel="stylesheet"><script src="https://cdn1.tianli0.top/npm/meting@2.0.1/dist/Meting.min.js"></script><script src="/js/main.js"></script><script>const pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:['meta[name="description"]',"title","#site-config",".index_content",".tab_warp"],cacheBust:!1,scrollRestoration:!1,analytics:!1});document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/")}))</script><script>const posts=["posts/a61e63c2/","posts/b19848b6/","posts/6177b8b5/","posts/c323bf04/","posts/ec7d7221/","posts/80cfaa0f/","posts/7a70876f/","posts/8f292cc0/","posts/30e05efc/"];function toRandomPost(){pjax.loadUrl("/"+posts[Math.floor(Math.random()*posts.length)])}</script></div></body></html>